
clear; clc;

%% global params

n = 500;    % #firms
t = 2000;   % #time horizon (20*months)
df_m = 5;   % degree of freedom of marginal t-dist
nu = 1000;     % degree of freedom of t-copula
rho = 0;  % pairwise correlation

% rho_block *todo*  

%% generate data

data = genData(n,t,rho,nu,df_m);

%% Compute Tail index measures for long-run

t = size(data,1);
M = t/20;

for i = 1 : M
    
%split data into months
idx = i*20-linspace(19,0,20);
X = data (idx,:);

%compute Tal index
Kelly(i) = CSTR(X);
Smooth(i) = SmoothCSTR(X);
[GP_k(i),GP_sigma(i)] = GP_Pool(X);

%fit cdf function
x = reshape(X,1,[]);    
q = quantile(x,.05);    
y = x(x<q)/q;
[F,yi] = ecdf(y); 
z = q - x(x<q);
[F1,zi] = ecdf(z);
cdf_Kelly = CDF_Tail(yi,Kelly(i));
cdf_smooth = CDF_Tail(yi,Smooth(i));
cdf_GP = gpcdf(zi,GP_k(i),GP_sigma(i));

%compute MSE
[pMSE_GP(i),pR2_GP(i)] = Fitness(cdf_GP,F);
[pMSE_Kelly(i),pR2_Kelly(i)] = Fitness(cdf_Kelly,F);
[pMSE_smooth(i),pR2_smooth(i)] = Fitness(cdf_smooth,F);

end



%% Compare pMSE

z = [pMSE_GP; pMSE_Kelly; pMSE_smooth];

% Wilconxon ranksum test


% Kolmogorov-Smirnov 2-sample test



%%

% function GPareto

% function Kelly

% function Smooth